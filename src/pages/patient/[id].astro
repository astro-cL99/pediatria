---
import MainLayout from '../../layouts/MainLayout.astro';
import PatientForm from '../../components/Patient/PatientForm.astro';
import ObservationTable from '../../components/Observation/ObservationTable.astro';

// In a real app, this would come from an API
const getPatient = (id: string) => {
  const patients = [
    {
      id: '1',
      name: 'Juan Pérez López',
      birthDate: '2020-05-15',
      gender: 'male',
      observations: [
        {
          id: 'obs1',
          code: '8867-4',
          display: 'Frecuencia cardíaca',
          value: '72 lpm',
          date: '2023-10-20T10:30:00Z',
          status: 'final'
        },
        {
          id: 'obs2',
          code: '8302-2',
          display: 'Talla',
          value: '85 cm',
          date: '2023-10-20T10:30:00Z',
          status: 'final'
        }
      ]
    }
  ];
  
  return patients.find(p => p.id === id);
};

const { id } = Astro.params;
const patient = getPatient(id);

if (!patient) {
  return Astro.redirect('/patients');
}
---

<MainLayout title={`${patient.name} - PediFlow Chile`}>
  <div class="mb-8">
    <a href="/patients" class="text-primary hover:underline flex items-center">
      <i class="fas fa-arrow-left mr-2"></i> Volver a la lista de pacientes
    </a>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Patient Information -->
    <div class="lg:col-span-1">
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h2 class="card-title">Información del Paciente</h2>
          
          <div class="space-y-4">
            <div>
              <h3 class="font-semibold">Nombre</h3>
              <p>{patient.name}</p>
            </div>
            
            <div>
              <h3 class="font-semibold">Fecha de Nacimiento</h3>
              <p>{new Date(patient.birthDate).toLocaleDateString()}</p>
            </div>
            
            <div>
              <h3 class="font-semibold">Género</h3>
              <p>
                {patient.gender === 'male' ? 'Masculino' : 
                 patient.gender === 'female' ? 'Femenino' : 'Otro'}
              </p>
            </div>
            
            <div class="divider"></div>
            
            <div class="card-actions">
              <button class="btn btn-primary w-full">
                <i class="fas fa-edit mr-2"></i>Editar Paciente
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Observations -->
    <div class="lg:col-span-2">
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <div class="flex justify-between items-center mb-6">
            <h2 class="card-title">Observaciones</h2>
            <button class="btn btn-primary btn-sm">
              <i class="fas fa-plus mr-2"></i>Nueva Observación
            </button>
          </div>
          
          <ObservationTable observations={patient.observations || []} />
        </div>
      </div>
    </div>
  </div>
</MainLayout>
