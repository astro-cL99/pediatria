import{l as te,aM as le,r as oe,aB as ne,j as e,$ as D,aC as ce,m as O,o as L,p as V,q as ie,n as Z,aD as n,ao as u,b0 as de,_ as M,s as z}from"./index-CHTwuzBj.js";import{u as me}from"./useQuery-BmdVUKZ_.js";function he(){const F=te(),{id:x}=le(),[C,_]=oe.useState(!1),{register:p,handleSubmit:G,watch:N,setValue:xe}=ne({defaultValues:{measurement_date:new Date().toISOString().slice(0,16)}}),{data:c}=me({queryKey:["patient",x],queryFn:async()=>{const{data:s,error:r}=await z.from("patients").select("*").eq("id",x).single();if(r)throw r;return s}}),h=N("weight"),b=N("height"),H=N("systolic_bp"),E=N("diastolic_bp"),I=(s,r)=>{if(s&&r&&s>0&&r>0){const a=.007184*Math.pow(s,.425)*Math.pow(r,.725);return parseFloat(a.toFixed(4))}},R=s=>{if(!s||s<=0)return;let r=0,a=[];if(s<=10)r=s*100,a.push(`${s} kg × 100 ml/kg = ${r} ml/día`);else if(s<=20){const l=(s-10)*50;r=1e3+l,a.push("10 kg × 100 ml/kg = 1000 ml"),a.push(`${(s-10).toFixed(1)} kg × 50 ml/kg = ${l} ml`),a.push(`Total = ${r} ml/día`)}else{const v=(s-20)*20;r=1500+v,a.push("10 kg × 100 ml/kg = 1000 ml"),a.push("10 kg × 50 ml/kg = 500 ml"),a.push(`${(s-20).toFixed(1)} kg × 20 ml/kg = ${v} ml`),a.push(`Total = ${r} ml/día`)}const t=r/24,i=t*20/60,d=t;return{totalMlPerDay:Math.round(r),mlPerHour:parseFloat(t.toFixed(1)),dropsPerMinute:Math.round(i),microdropsPerMinute:Math.round(d),calculation:a,note:"Fórmula de Holliday-Segar para hidratación basal"}},S=(s,r)=>{if(s&&r&&r>0){const a=r/100,t=s/(a*a);return parseFloat(t.toFixed(2))}},$=s=>{const r=new Date,a=new Date(s),t=(r.getFullYear()-a.getFullYear())*12+(r.getMonth()-a.getMonth()),i=Math.floor(t/12),d=t%12;return{years:i,months:d,totalMonths:t}},Y=(s,r,a)=>{const t=$(a);return t.totalMonths<12?{type:"Peso/Edad",description:"Indicador nutricional para menores de 1 año",note:"Se evalúa con tablas de percentiles OMS"}:t.years>=1&&t.years<5&&r>0?{type:"Peso/Talla",value:(s/r*100).toFixed(2),description:"Indicador nutricional para 1-5 años",note:"Se evalúa con tablas de percentiles OMS"}:t.years>=5?{type:"IMC (Índice de Masa Corporal)",value:S(s,r),description:"Indicador nutricional para mayores de 5 años",note:"Se evalúa con tablas de percentiles OMS"}:null},K=(s,r,a,t,i="male")=>{const d=$(t);if(d.years<1||d.years>=18)return{status:"No aplicable",note:"El cálculo de percentil de PA es para niños de 1 a 17 años"};const l=((q,pe)=>{const k=90+q*1.5,W=k+10,X=k+12,ee=k+16,P=50+q*.8,se=P+8,re=P+10,ae=P+14;return{systolic:{p50:k,p90:W,p95:X,p99:ee},diastolic:{p50:P,p90:se,p95:re,p99:ae}}})(d.years),v=(l.systolic.p95-l.systolic.p50)/1.645,U=(l.diastolic.p95-l.diastolic.p50)/1.645,B=(s-l.systolic.p50)/v,T=(r-l.diastolic.p50)/U;let y="",f="";return s<l.systolic.p90&&r<l.diastolic.p90?(y="Normal",f="green"):s>=l.systolic.p90&&s<l.systolic.p95?(y="Prehipertensión",f="yellow"):s>=l.systolic.p95&&s<l.systolic.p99?(y="HTA Estadio 1",f="orange"):s>=l.systolic.p99&&(y="HTA Estadio 2",f="red"),{systolic:{value:s,zScore:B.toFixed(2),percentile:B>0?"> P50":"< P50",reference:l.systolic},diastolic:{value:r,zScore:T.toFixed(2),percentile:T>0?"> P50":"< P50",reference:l.diastolic},classification:y,color:f,note:"Valores de referencia basados en tablas de la AAP (American Academy of Pediatrics)"}},Q=async s=>{if(!x){M.error("ID de paciente no encontrado");return}_(!0);try{const r=parseFloat(s.weight),a=parseFloat(s.height),t=s.head_circumference?parseFloat(s.head_circumference):null;if(isNaN(r)||isNaN(a)){M.error("Por favor ingresa valores numéricos válidos"),_(!1);return}const i=S(r,a),d=I(r,a),{error:j}=await z.from("anthropometric_data").insert({patient_id:x,weight_kg:r,height_cm:a,head_circumference_cm:t,bmi:i||null,body_surface_area:d||null,measured_at:s.measurement_date,notes:s.notes||null});if(j)throw j;M.success("Medición antropométrica registrada exitosamente"),F(`/patient/${x}`)}catch(r){console.error("Error saving anthropometry:",r),M.error(r.message||"Error al guardar medición")}finally{_(!1)}},J=s=>{const r=new Date,a=new Date(s),t=r.getFullYear()-a.getFullYear(),i=r.getMonth()-a.getMonth();return t<1?`${i+t*12} meses`:`${t} años`},w=S(parseFloat(h),parseFloat(b)),A=I(parseFloat(h),parseFloat(b)),m=h?R(parseFloat(h)):null,g=c!=null&&c.date_of_birth&&h&&b?Y(parseFloat(h),parseFloat(b),c.date_of_birth):null,o=c!=null&&c.date_of_birth&&H&&E&&b?K(parseFloat(H),parseFloat(E),parseFloat(b),c.date_of_birth):null;return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{variant:"ghost",onClick:()=>F(`/patient/${x}`),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Nueva Medición Antropométrica"}),c&&e.jsxs("p",{className:"text-muted-foreground",children:[c.name," - ",J(c.date_of_birth)]})]})]}),e.jsxs("form",{onSubmit:G(Q),className:"space-y-6",children:[e.jsxs(O,{children:[e.jsxs(L,{children:[e.jsx(V,{children:"Datos de Medición"}),e.jsx(ie,{children:"Registra las medidas antropométricas del paciente"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(n,{htmlFor:"measurement_date",children:"Fecha y Hora de Medición *"}),e.jsx(u,{type:"datetime-local",...p("measurement_date",{required:!0})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"weight",children:"Peso (kg) *"}),e.jsx(u,{id:"weight",type:"number",step:"0.01",placeholder:"Ej: 15.5",...p("weight",{required:"El peso es requerido",min:{value:.1,message:"El peso debe ser mayor a 0.1 kg"},max:{value:200,message:"El peso debe ser menor a 200 kg"}})})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"height",children:"Talla (cm) *"}),e.jsx(u,{id:"height",type:"number",step:"0.1",placeholder:"Ej: 105.5",...p("height",{required:"La talla es requerida",min:{value:1,message:"La talla debe ser mayor a 1 cm"},max:{value:250,message:"La talla debe ser menor a 250 cm"}})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"head_circumference",children:"Perímetro Cefálico (cm)"}),e.jsx(u,{id:"head_circumference",type:"number",step:"0.1",placeholder:"Ej: 48.5",...p("head_circumference",{min:{value:1,message:"Debe ser mayor a 1 cm"},max:{value:100,message:"Debe ser menor a 100 cm"}})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Opcional - Importante en menores de 2 años"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"systolic_bp",children:"Presión Sistólica (mmHg)"}),e.jsx(u,{id:"systolic_bp",type:"number",step:"1",placeholder:"Ej: 110",...p("systolic_bp",{min:{value:50,message:"Debe ser mayor a 50 mmHg"},max:{value:200,message:"Debe ser menor a 200 mmHg"}})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Opcional - Para cálculo de percentil PA"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"diastolic_bp",children:"Presión Diastólica (mmHg)"}),e.jsx(u,{id:"diastolic_bp",type:"number",step:"1",placeholder:"Ej: 70",...p("diastolic_bp",{min:{value:30,message:"Debe ser mayor a 30 mmHg"},max:{value:150,message:"Debe ser menor a 150 mmHg"}})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Opcional - Para cálculo de percentil PA"})]})]}),(w||A||m||g||o)&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Cálculos Automáticos"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[w&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx(n,{className:"text-blue-900 dark:text-blue-100",children:"IMC (Índice de Masa Corporal)"}),e.jsxs("div",{className:"flex items-baseline gap-2 mt-2",children:[e.jsx("span",{className:"text-3xl font-bold text-blue-600",children:w}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"kg/m²"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Fórmula: peso / altura²"})]}),A&&e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsx(n,{className:"text-purple-900 dark:text-purple-100",children:"Superficie Corporal (DuBois)"}),e.jsxs("div",{className:"flex items-baseline gap-2 mt-2",children:[e.jsx("span",{className:"text-3xl font-bold text-purple-600",children:A}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"m²"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Fórmula: 0.007184 × peso^0.425 × talla^0.725"})]})]}),m&&e.jsxs("div",{className:"p-4 bg-cyan-50 dark:bg-cyan-950/20 rounded-lg border border-cyan-200 dark:border-cyan-800",children:[e.jsx(n,{className:"text-cyan-900 dark:text-cyan-100",children:"Hidratación Basal (Holliday-Segar)"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-cyan-600",children:m.totalMlPerDay}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"ml/día"})]}),e.jsx("div",{className:"bg-cyan-100 dark:bg-cyan-900/30 p-2 rounded text-xs space-y-1",children:m.calculation.map((s,r)=>e.jsx("p",{className:"text-cyan-800 dark:text-cyan-200",children:s},r))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded border border-cyan-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"ml/hora"}),e.jsx("p",{className:"text-lg font-bold text-cyan-600",children:m.mlPerHour})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded border border-cyan-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"gotas/min"}),e.jsx("p",{className:"text-lg font-bold text-cyan-600",children:m.dropsPerMinute})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded border border-cyan-200",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"μgts/min"}),e.jsx("p",{className:"text-lg font-bold text-cyan-600",children:m.microdropsPerMinute})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m.note})]})]}),g&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx(n,{className:"text-green-900 dark:text-green-100",children:g.type}),g.value&&e.jsx("div",{className:"flex items-baseline gap-2 mt-2",children:e.jsx("span",{className:"text-3xl font-bold text-green-600",children:g.value})}),e.jsx("p",{className:"text-sm text-green-800 dark:text-green-200 mt-2",children:g.description}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.note})]}),o&&o.classification&&e.jsxs("div",{className:`p-4 rounded-lg border ${o.color==="green"?"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800":o.color==="yellow"?"bg-yellow-50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-800":o.color==="orange"?"bg-orange-50 dark:bg-orange-950/20 border-orange-200 dark:border-orange-800":"bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800"}`,children:[e.jsx(n,{className:o.color==="green"?"text-green-900 dark:text-green-100":o.color==="yellow"?"text-yellow-900 dark:text-yellow-100":o.color==="orange"?"text-orange-900 dark:text-orange-100":"text-red-900 dark:text-red-100",children:"Percentil de Presión Arterial"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sistólica"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold",children:o.systolic.value}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"mmHg"})]}),e.jsxs("p",{className:"text-xs mt-1",children:["Z-score: ",e.jsx("strong",{children:o.systolic.zScore})," DE"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Diastólica"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold",children:o.diastolic.value}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"mmHg"})]}),e.jsxs("p",{className:"text-xs mt-1",children:["Z-score: ",e.jsx("strong",{children:o.diastolic.zScore})," DE"]})]})]}),e.jsx("div",{className:`p-2 rounded text-center font-semibold ${o.color==="green"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":o.color==="yellow"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":o.color==="orange"?"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-200":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200"}`,children:o.classification}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o.note})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"notes",children:"Notas"}),e.jsx(u,{placeholder:"Observaciones adicionales (opcional)",...p("notes")})]})]})]}),e.jsxs(O,{className:"bg-muted/50",children:[e.jsx(L,{children:e.jsx(V,{className:"text-sm",children:"Información - Criterios SEGHNP"})}),e.jsxs(Z,{className:"text-sm space-y-2",children:[e.jsx("p",{className:"font-semibold",children:"Cálculos Automáticos:"}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"IMC:"})," peso (kg) / altura² (m)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Superficie Corporal (DuBois):"})," 0.007184 × peso^0.425 × talla^0.725"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Hidratación Basal (Holliday-Segar):"})," Volumen diario según peso"]}),e.jsx("p",{className:"text-xs ml-4",children:"- 0-10 kg: 100 ml/kg/día"}),e.jsxs("p",{className:"text-xs ml-4",children:["- 10-20 kg: 1000 ml + 50 ml/kg (por cada kg ",">"," 10)"]}),e.jsxs("p",{className:"text-xs ml-4",children:["- ",">"," 20 kg: 1500 ml + 20 ml/kg (por cada kg ",">"," 20)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Percentil PA:"})," Z-score basado en edad, talla y sexo"]}),e.jsx("p",{className:"font-semibold mt-3",children:"Indicadores Nutricionales según Edad:"}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Menores de 1 año:"})," Se evalúa Peso/Edad"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"1 a 5 años:"})," Se evalúa Peso/Talla"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Mayores de 5 años:"})," Se evalúa IMC"]}),e.jsx("p",{className:"font-semibold mt-3",children:"Clasificación de Presión Arterial:"}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Normal:"})," ","<"," P90"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Prehipertensión:"})," P90 - P95"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"HTA Estadio 1:"})," P95 - P99"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"HTA Estadio 2:"})," ≥ P99"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"* Criterios basados en SEGHNP y AAP (American Academy of Pediatrics)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>F(`/patient/${x}`),children:"Cancelar"}),e.jsxs(D,{type:"submit",disabled:C,children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),C?"Guardando...":"Guardar Medición"]})]})]})]})}export{he as default};
