import{l as q,r as g,s as N,_ as E,j as e,$ as f,aA as y,m as n,o as d,p as c,a5 as U,n as m,v as p,a8 as z,an as I,ao as W,a1 as $,a2 as F,a3 as v,a6 as _,B as o,q as H,aS as M,aP as R}from"./index-CHTwuzBj.js";import{U as C}from"./user-plus-Bh9wLDzI.js";import{W as k,P,D as V,d as Y}from"./differenceInDays-BzrW5OJE.js";function Q(){const u=q(),[S,T]=g.useState([]),[r,A]=g.useState(""),[D,B]=g.useState(!0),[j,L]=g.useState("all");g.useEffect(()=>{w();const s=N.channel("patients-bed-assignments").on("postgres_changes",{event:"*",schema:"public",table:"bed_assignments"},()=>w()).subscribe();return()=>{N.removeChannel(s)}},[]);const w=async()=>{try{const{data:s,error:a}=await N.from("bed_assignments").select(`
          *,
          patient:patients(*),
          admission:admissions(*)
        `).eq("is_active",!0).order("room_number").order("bed_number");if(a)throw a;T(s||[])}catch(s){console.error("Error fetching bed assignments:",s),E.error("Error al cargar pacientes hospitalizados")}finally{B(!1)}},O=s=>{const a=new Date,i=new Date(s),l=a.getFullYear()-i.getFullYear(),h=a.getMonth()-i.getMonth();return l<1?`${h+l*12}m`:`${l}a`},b=s=>Y(new Date,new Date(s)),t=S.filter(s=>{const a=s.patient.name.toLowerCase().includes(r.toLowerCase())||s.patient.rut.toLowerCase().includes(r.toLowerCase())||s.room_number.includes(r),i=j==="all"||j==="pediatria"&&s.room_number.startsWith("50")||j==="cirugia"&&s.room_number.startsWith("60");return a&&i}),x={total:t.length,withO2:t.filter(s=>s.admission.oxygen_requirement&&Object.keys(s.admission.oxygen_requirement).length>0).length,withATB:t.filter(s=>s.admission.antibiotics&&Object.keys(s.admission.antibiotics).length>0).length,withPending:t.filter(s=>s.admission.pending_tasks&&s.admission.pending_tasks.trim().length>0).length,avgDays:t.length>0?Math.round(t.reduce((s,a)=>s+b(a.admission.admission_date),0)/t.length):0};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Pacientes Hospitalizados"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gestión y seguimiento de pacientes activos"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",onClick:()=>u("/admission/new"),className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"Nuevo Ingreso"]}),e.jsxs(f,{onClick:()=>u("/patient/new"),className:"gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"Nuevo Paciente"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(n,{className:"border-l-4 border-l-blue-500 hover:shadow-lg transition-shadow",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Total Pacientes"}),e.jsx(U,{className:"h-4 w-4 text-blue-500"})]})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:x.total})})]}),e.jsxs(n,{className:"border-l-4 border-l-red-500 hover:shadow-lg transition-shadow",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Con Soporte O2"}),e.jsx(k,{className:"h-4 w-4 text-red-500"})]})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold text-red-600",children:x.withO2})})]}),e.jsxs(n,{className:"border-l-4 border-l-yellow-500 hover:shadow-lg transition-shadow",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Con Antibióticos"}),e.jsx(P,{className:"h-4 w-4 text-yellow-600"})]})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:x.withATB})})]}),e.jsxs(n,{className:"border-l-4 border-l-orange-500 hover:shadow-lg transition-shadow",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Con Pendientes"}),e.jsx(p,{className:"h-4 w-4 text-orange-500"})]})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:x.withPending})})]}),e.jsxs(n,{className:"border-l-4 border-l-purple-500 hover:shadow-lg transition-shadow",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Promedio Días"}),e.jsx(z,{className:"h-4 w-4 text-purple-500"})]})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:x.avgDays})})]})]}),e.jsx(n,{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(W,{placeholder:"Buscar por paciente, RUT o número de sala...",value:r,onChange:s=>A(s.target.value),className:"pl-10"})]}),e.jsx($,{value:j,onValueChange:s=>L(s),className:"w-full md:w-auto",children:e.jsxs(F,{className:"grid w-full md:w-auto grid-cols-3",children:[e.jsx(v,{value:"all",children:"Todos"}),e.jsx(v,{value:"pediatria",children:"Pediatría"}),e.jsx(v,{value:"cirugia",children:"Cirugía"})]})})]})})}),e.jsx("div",{children:D?e.jsx(n,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4 animate-pulse"}),e.jsx("p",{className:"text-lg font-medium",children:"Cargando pacientes..."})]})}):t.length===0?e.jsx(n,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-xl font-semibold mb-2",children:r?"No se encontraron pacientes":"No hay pacientes hospitalizados"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:r?"Intenta con otro término de búsqueda":"Los pacientes hospitalizados aparecerán aquí"}),!r&&e.jsxs(f,{onClick:()=>u("/admission/new"),children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Crear Nuevo Ingreso"]})]})}):e.jsx("div",{className:"grid gap-4",children:t.map(s=>{const a=b(s.admission.admission_date),i=s.admission.oxygen_requirement&&Object.keys(s.admission.oxygen_requirement).length>0,l=s.admission.antibiotics&&Object.keys(s.admission.antibiotics).length>0,h=s.admission.viral_panel&&s.admission.viral_panel.toLowerCase().includes("positivo");return e.jsxs(n,{className:"hover:shadow-xl transition-all duration-300 cursor-pointer border-l-4 hover:scale-[1.01]",style:{borderLeftColor:i?"#ef4444":l?"#eab308":h?"#3b82f6":"#10b981"},onClick:()=>u(`/patient/${s.patient_id}`),children:[e.jsx(d,{className:"pb-3",children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[e.jsx(c,{className:"text-xl font-bold",children:s.patient.name}),s.patient.allergies&&e.jsxs(o,{variant:"destructive",className:"text-xs animate-pulse",children:[e.jsx(p,{className:"h-3 w-3 mr-1"}),"Alergia"]})]}),e.jsxs(H,{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm",children:[e.jsxs("span",{className:"font-medium",children:["RUT: ",s.patient.rut]}),e.jsxs("span",{children:["Edad: ",O(s.patient.date_of_birth)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),"Sala ",s.room_number,"-",s.bed_number]}),e.jsxs("span",{className:"flex items-center gap-1 font-medium",children:[e.jsx(R,{className:"w-3 h-3"}),a," ",a===1?"día":"días"]})]})]})})}),e.jsxs(m,{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i&&e.jsxs(o,{variant:"destructive",className:"gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),"Soporte O2"]}),l&&e.jsxs(o,{className:"bg-yellow-600 hover:bg-yellow-700 gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"Antibióticos"]}),h&&e.jsxs(o,{variant:"secondary",className:"gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),"Panel Viral +"]}),s.admission.respiratory_score&&e.jsxs(o,{variant:"outline",className:"gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),"Score: ",s.admission.respiratory_score]}),!i&&!l&&!h&&e.jsx(o,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Estable"})]}),s.admission.admission_diagnoses&&s.admission.admission_diagnoses.length>0&&e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Diagnóstico: "}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.admission.admission_diagnoses[0]}),s.admission.admission_diagnoses.length>1&&e.jsxs(o,{variant:"secondary",className:"ml-2 text-xs",children:["+",s.admission.admission_diagnoses.length-1," más"]})]}),s.admission.pending_tasks&&s.admission.pending_tasks.trim().length>0&&e.jsx("div",{className:"bg-orange-50 dark:bg-orange-950/20 p-3 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-orange-900 dark:text-orange-100",children:"Pendientes: "}),e.jsx("span",{className:"text-sm text-orange-800 dark:text-orange-200",children:s.admission.pending_tasks})]})]})}),s.patient.allergies&&e.jsx("div",{className:"bg-red-50 dark:bg-red-950/20 p-3 rounded-lg border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-red-900 dark:text-red-100",children:"Alergias: "}),e.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:s.patient.allergies})]})]})})]})]},s.id)})})})]})}export{Q as default};
