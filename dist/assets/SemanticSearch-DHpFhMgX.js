import{r as c,j as e,aw as N,m as d,o as _,p as S,q as w,n as m,ao as C,ap as E,aq as T,ar as q,as as B,at as s,$ as I,a0 as D,an as F,F as k,B as j,a7 as z,aj as H,_ as x,s as p}from"./index-CHTwuzBj.js";const P=()=>{const[n,b]=c.useState(""),[t,y]=c.useState([]),[o,u]=c.useState(!1),[l,f]=c.useState({documentType:""}),h=async()=>{if(!n.trim()){x.error("Por favor ingresa una consulta");return}u(!0);try{const{data:a,error:i}=await p.functions.invoke("generate-embeddings",{body:{query:n}});if(i)throw i;const{data:r,error:g}=await p.rpc("search_clinical_documents",{query_embedding:a.embedding,match_threshold:.4,match_count:10,filter_type:l.documentType||null});if(g)throw g;y(r||[]),x.success(`${(r==null?void 0:r.length)||0} documentos encontrados`)}catch(a){console.error("Error en búsqueda:",a),x.error(a.message||"Error al realizar búsqueda")}finally{u(!1)}},v=a=>({ingreso:"bg-blue-500",evolucion:"bg-green-500",epicrisis:"bg-purple-500",laboratorio:"bg-yellow-500",imagenologia:"bg-orange-500",interconsulta:"bg-pink-500",dau:"bg-red-500",receta:"bg-indigo-500",otro:"bg-gray-500"})[a]||"bg-gray-500";return e.jsx(N,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Búsqueda Inteligente"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Busca documentos clínicos usando lenguaje natural"})]}),e.jsxs(d,{children:[e.jsxs(_,{children:[e.jsx(S,{children:"Buscar Documentos"}),e.jsx(w,{children:'Ejemplo: "casos de bronquiolitis en lactantes menores de 6 meses"'})]}),e.jsx(m,{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{placeholder:"Escribe tu consulta en lenguaje natural...",value:n,onChange:a=>b(a.target.value),onKeyPress:a=>a.key==="Enter"&&h(),className:"flex-1"}),e.jsxs(E,{value:l.documentType,onValueChange:a=>f({...l,documentType:a}),children:[e.jsx(T,{className:"w-[200px]",children:e.jsx(q,{placeholder:"Tipo de documento"})}),e.jsxs(B,{children:[e.jsx(s,{value:"",children:"Todos"}),e.jsx(s,{value:"ingreso",children:"Ingreso"}),e.jsx(s,{value:"evolucion",children:"Evolución"}),e.jsx(s,{value:"epicrisis",children:"Epicrisis"}),e.jsx(s,{value:"laboratorio",children:"Laboratorio"}),e.jsx(s,{value:"imagenologia",children:"Imagenología"}),e.jsx(s,{value:"interconsulta",children:"Interconsulta"}),e.jsx(s,{value:"dau",children:"DAU"})]})]}),e.jsx(I,{onClick:h,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Buscando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Buscar"]})})]})})]}),t.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Resultados (",t.length,")"]}),t.map(a=>e.jsx(d,{className:"hover:shadow-lg transition-shadow",children:e.jsx(m,{className:"p-6",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold",children:a.file_name}),e.jsx(j,{className:v(a.document_type),children:a.document_type}),e.jsxs(j,{variant:"outline",children:[(a.similarity*100).toFixed(0),"% relevante"]})]}),a.patient_name&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Paciente: ",a.patient_name," (",a.patient_rut,")"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(z,{className:"h-4 w-4"}),H(new Date(a.uploaded_at),"dd/MM/yyyy HH:mm")]}),a.extracted_data&&e.jsxs("div",{className:"mt-3 p-3 bg-muted rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium mb-2",children:"Contenido extraído:"}),a.extracted_data.diagnosticos&&e.jsxs("p",{children:["Diagnósticos: ",JSON.stringify(a.extracted_data.diagnosticos)]}),a.extracted_data.hallazgos&&e.jsxs("p",{children:["Hallazgos: ",a.extracted_data.hallazgos]}),a.extracted_data.conclusion&&e.jsxs("p",{children:["Conclusión: ",a.extracted_data.conclusion]})]})]})})})},a.id))]}),!o&&t.length===0&&n&&e.jsx(d,{children:e.jsx(m,{className:"p-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No se encontraron documentos relevantes para tu búsqueda"})})})]})})};export{P as default};
