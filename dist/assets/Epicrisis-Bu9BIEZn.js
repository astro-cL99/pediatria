import{l as y,r as w,j as e,$ as l,aA as N,m as _,o as v,p as C,q as b,n as E,an as T,ao as L,aj as m,au as D,s as u,ak as R}from"./index-CHTwuzBj.js";import{u as k}from"./useQuery-BmdVUKZ_.js";import{T as U,a as M,b as j,c as a,d as F,e as r}from"./table-Bx6tkyc3.js";import{E as H}from"./eye-8LsxB1rk.js";function Q(){const o=y(),[t,p]=w.useState(""),{data:n,isLoading:f}=k({queryKey:["epicrisis"],queryFn:async()=>{const{data:s,error:i}=await u.from("epicrisis").select("*").order("created_at",{ascending:!1});if(i)throw i;return s}}),c=n==null?void 0:n.filter(s=>s.patient_name.toLowerCase().includes(t.toLowerCase())||s.patient_rut.includes(t)||s.admission_diagnosis.toLowerCase().includes(t.toLowerCase())),g=async s=>{if(!s.pdf_file_path)return;const{data:i,error:h}=await u.storage.from("medical-documents").download(s.pdf_file_path);if(h){console.error("Error downloading PDF:",h);return}const x=URL.createObjectURL(i),d=document.createElement("a");d.href=x,d.download=`epicrisis_${s.patient_rut}_${m(new Date(s.discharge_date),"yyyy-MM-dd")}.pdf`,d.click(),URL.revokeObjectURL(x)};return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Epicrisis"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestión de epicrisis hospitalarias"})]}),e.jsxs(l,{onClick:()=>o("/epicrisis/new"),children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"Nueva Epicrisis"]})]}),e.jsxs(_,{children:[e.jsxs(v,{children:[e.jsx(C,{children:"Historial de Epicrisis"}),e.jsx(b,{children:"Listado de todas las epicrisis generadas"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(L,{placeholder:"Buscar por paciente, RUT o diagnóstico...",value:t,onChange:s=>p(s.target.value),className:"pl-10"})]})}),f?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando epicrisis..."}):c&&c.length>0?e.jsxs(U,{children:[e.jsx(M,{children:e.jsxs(j,{children:[e.jsx(a,{children:"Paciente"}),e.jsx(a,{children:"RUT"}),e.jsx(a,{children:"Fecha Egreso"}),e.jsx(a,{children:"Diagnóstico Egreso"}),e.jsx(a,{children:"Médico"}),e.jsx(a,{className:"text-right",children:"Acciones"})]})}),e.jsx(F,{children:c.map(s=>e.jsxs(j,{children:[e.jsx(r,{className:"font-medium",children:s.patient_name}),e.jsx(r,{children:s.patient_rut}),e.jsx(r,{children:m(new Date(s.discharge_date),"dd/MM/yyyy",{locale:R})}),e.jsx(r,{children:e.jsx("div",{className:"max-w-xs truncate",title:s.discharge_diagnosis,children:s.discharge_diagnosis})}),e.jsx(r,{children:s.attending_physician}),e.jsxs(r,{className:"text-right space-x-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>o(`/epicrisis/${s.id}`),children:e.jsx(H,{className:"h-4 w-4"})}),s.pdf_file_path&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>g(s),children:e.jsx(D,{className:"h-4 w-4"})})]})]},s.id))})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t?"No se encontraron resultados":"No hay epicrisis registradas"})]})]})]})}export{Q as default};
